<!DOCTYPE html>
<html lang="zh-CN">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>å¤§çŒ«çŒ«æ–—æ¶é¾™ Ver3.08</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- å…¨å±€æ ·å¼ --- */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background-color: #2c3e50;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  font-family: "Microsoft YaHei", sans-serif;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  touch-action: none;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #gameContainer {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  max-width: 480px;
Â  Â  Â  Â  Â  Â  max-height: 900px;
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 30px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ç•Œé¢å±‚çº§ --- */
Â  Â  Â  Â  .layer {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.98);
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  }
Â  Â  Â  Â  .active { display: flex; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .layer-scroll {
Â  Â  Â  Â  Â  Â  justify-content: flex-start;
Â  Â  Â  Â  Â  Â  padding-top: 40px;
Â  Â  Â  Â  Â  Â  padding-bottom: 60px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- åŸºç¡€ç»„ä»¶ --- */
Â  Â  Â  Â  h1 { color: #e67e22; text-shadow: 2px 2px #f1c40f; margin-bottom: 5px; text-align: center; flex-shrink: 0;}
Â  Â  Â  Â  h2 { color: #2c3e50; margin-bottom: 20px; text-align: center; }
Â  Â  Â  Â  .version { color: #7f8c8d; font-size: 12px; margin-bottom: 20px; flex-shrink: 0;}
Â  Â  Â  Â  input { padding: 12px; border: 2px solid #3498db; border-radius: 8px; width: 70%; text-align: center; font-size: 16px; margin-bottom: 20px; flex-shrink: 0;}
Â  Â  Â  Â Â 
Â  Â  Â  Â  button { padding: 10px 25px; background: #e67e22; color: white; border: none; border-radius: 20px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #d35400; transition: all 0.1s; margin: 5px; flex-shrink: 0;}
Â  Â  Â  Â  button:active { transform: translateY(4px); box-shadow: 0 0 0 #d35400; }
Â  Â  Â  Â  button:disabled { background: #bdc3c7; box-shadow: none; cursor: not-allowed; transform: none; color: #fff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-blue { background: #3498db; box-shadow: 0 4px 0 #2980b9; }
Â  Â  Â  Â  .btn-blue:active { transform: translateY(4px); box-shadow: 0 0 0 #2980b9; }
Â  Â  Â  Â  .btn-green { background: #2ecc71; box-shadow: 0 4px 0 #27ae60; width: 80%; }
Â  Â  Â  Â  .btn-green:active { transform: translateY(4px); box-shadow: 0 0 0 #27ae60; }
Â  Â  Â  Â  .btn-gray { background: #95a5a6; box-shadow: 0 4px 0 #7f8c8d; font-size: 14px; padding: 8px 20px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-home {
Â  Â  Â  Â  Â  Â  position: absolute; top: 10px; left: 10px; width: 36px; height: 36px; border-radius: 50%;
Â  Â  Â  Â  Â  Â  background: #fff; border: 2px solid #bdc3c7; color: #7f8c8d; font-size: 20px;
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center; cursor: pointer;
Â  Â  Â  Â  Â  Â  z-index: 20; padding: 0; margin: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- å­˜æ¡£æ§½ä½æ ·å¼ --- */
Â  Â  Â  Â  .slot-container { width: 100%; display: flex; flex-direction: column; gap: 15px; }
Â  Â  Â  Â  .save-slot {
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  border: 2px solid #bdc3c7;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .save-slot:hover { border-color: #3498db; transform: scale(1.01); }
Â  Â  Â  Â  .save-slot.empty { border-style: dashed; background: #f9f9f9; color: #95a5a6; justify-content: center; }
Â  Â  Â  Â  .slot-info { display: flex; flex-direction: column; align-items: flex-start; }
Â  Â  Â  Â  .slot-title { font-weight: bold; color: #2c3e50; font-size: 16px; display: flex; align-items: center; gap: 5px; }
Â  Â  Â  Â  .slot-detail { font-size: 12px; color: #7f8c8d; margin-top: 5px; }
Â  Â  Â  Â  .slot-icon { width: 30px; height: 30px; }
Â  Â  Â  Â  .delete-btn {
Â  Â  Â  Â  Â  Â  padding: 5px 10px; font-size: 12px; background: #e74c3c; border-radius: 5px; margin-left: 10px; z-index: 5; color: white; width: auto; box-shadow: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- æ—¥å¿— & å±æ€§ --- */
Â  Â  Â  Â  .scroll-box {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  background: #f9f9f9;
Â  Â  Â  Â  Â  Â  border: 2px solid #bdc3c7;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  cursor: grab;
Â  Â  Â  Â  Â  Â  min-height: 200px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scroll-box:active { cursor: grabbing; }
Â  Â  Â  Â  .log-block { margin-bottom: 20px; border-bottom: 1px dashed #eee; padding-bottom: 15px; }
Â  Â  Â  Â  .log-ver { color: #e67e22; font-weight: 900; font-size: 16px; margin-bottom: 5px; }
Â  Â  Â  Â  .log-date { color: #95a5a6; font-size: 12px; margin-bottom: 8px; }
Â  Â  Â  Â  .log-list { padding-left: 20px; margin: 0; }
Â  Â  Â  Â  .log-list li { font-size: 13px; color: #34495e; margin-bottom: 4px; line-height: 1.5; }
Â  Â  Â  Â  .highlight { color: #c0392b; font-weight: bold; }
Â  Â  Â  Â  .attr-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; font-size: 14px; color: #34495e; }
Â  Â  Â  Â  .attr-val { color: #2980b9; font-family: monospace; font-size: 16px; }

Â  Â  Â  Â  /* --- èŒä¸šé€‰æ‹© --- */
Â  Â  Â  Â  .card-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; padding-bottom: 20px; }
Â  Â  Â  Â  .class-card { background: white; border: 2px solid #bdc3c7; border-radius: 10px; padding: 8px; text-align: center; cursor: pointer; transition: transform 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; }
Â  Â  Â  Â  .class-card:hover { border-color: #3498db; transform: scale(1.02); }
Â  Â  Â  Â  .class-card h3 { margin: 5px 0; color: #2c3e50; font-size: 15px; }
Â  Â  Â  Â  .svg-icon { width: 60px; height: 60px; margin: 5px auto; }
Â  Â  Â  Â  .stats-text { font-size: 9px; color: #7f8c8d; text-align: left; line-height: 1.3; width: 100%; }
Â  Â  Â  Â  .talent-text { font-size: 9px; color: #c0392b; margin-top: 5px; font-weight: bold; text-align: left; border-top: 1px dashed #eee; padding-top:5px; width: 100%; }

Â  Â  Â  Â  /* --- æˆ˜æ–—ç•Œé¢ --- */
Â  Â  Â  Â  #battleLayer { background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 70%, #90EE90 70%, #90EE90 100%); justify-content: space-between; padding: 0; overflow: hidden;}
Â  Â  Â  Â  .cloud { position: absolute; background: white; border-radius: 50px; opacity: 0.8; animation: floatCloud 20s linear infinite; }
Â  Â  Â  Â  @keyframes floatCloud { from { left: -100px; } to { left: 100%; } }
Â  Â  Â  Â  .battle-hud { width: 100%; background: rgba(0,0,0,0.6); color: white; padding: 8px 15px; padding-left: 50px; box-sizing: border-box; display: flex; justify-content: space-between; font-size: 14px; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .battle-scene { flex-grow: 1; width: 100%; position: relative; display: flex; justify-content: space-around; align-items: flex-end; padding-bottom: 25%; z-index: 2; }
Â  Â  Â  Â  .fighter { width: 120px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; position: relative; transition: transform 0.2s; }
Â  Â  Â  Â  .fighter-svg { width: 100%; height: 100%; filter: drop-shadow(0 5px 2px rgba(0,0,0,0.2)); }
Â  Â  Â  Â  .status-box { position: absolute; top: -40px; width: 100%; text-align: center; }
Â  Â  Â  Â  .fighter-name { background: rgba(0,0,0,0.5); color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 12px; display: inline-block; margin-bottom: 2px; }
Â  Â  Â  Â  .bar-bg { width: 80px; height: 8px; background: #333; border-radius: 4px; margin: 1px auto; overflow: hidden; border:1px solid #fff;}
Â  Â  Â  Â  .hp-fill { height: 100%; background: #e74c3c; width: 100%; transition: width 0.3s; }
Â  Â  Â  Â  .mp-fill { height: 100%; background: #3498db; width: 100%; transition: width 0.3s; }

Â  Â  Â  Â  .toolbar { position: absolute; bottom: 140px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 6; padding: 0 5px; }
Â  Â  Â  Â  .tool-btn { width: 40px; height: 40px; background: #fff; border: 2px solid #bdc3c7; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.1s; }
Â  Â  Â  Â  .tool-btn:active { transform: scale(0.9); }
Â  Â  Â  Â  .tool-btn svg { width: 22px; height: 22px; }

Â  Â  Â  Â  .bottom-panel { width: 100%; background: #fff; padding: 10px; box-sizing: border-box; border-top: 4px solid #f1c40f; z-index: 5; }
Â  Â  Â  Â  .exp-container { width: 100%; height: 15px; background: #bdc3c7; border-radius: 8px; overflow: hidden; position: relative; box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); }
Â  Â  Â  Â  .exp-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #f39c12); width: 0%; transition: width 0.5s; }
Â  Â  Â  Â  .exp-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; text-align: center; font-size: 10px; line-height: 15px; color: #333; font-weight: bold; }

Â  Â  Â  Â  .floating-text { position: absolute; font-weight: 900; font-size: 28px; animation: floatUp 0.8s ease-out forwards; text-shadow: 2px 2px 0 #fff; z-index: 20; white-space: nowrap; left: 50%; transform: translateX(-50%); top: -40px; pointer-events: none;}
Â  Â  Â  Â  @keyframes floatUp { 0% { top: -40px; opacity: 1; transform: translateX(-50%) scale(1); } 100% { top: -90px; opacity: 0; transform: translateX(-50%) scale(1.2); } }

Â  Â  Â  Â  .slash-effect { position: absolute; width: 150px; height: 150px; background: transparent; border: 2px solid transparent; z-index: 15; left: 50%; top: 50%; transform: translate(-50%, -50%); pointer-events: none; }
Â  Â  Â  Â  .slash-effect::before { content: ''; position: absolute; left: 0; top: 50%; width: 100%; height: 4px; background: #e74c3c; transform: rotate(-45deg); box-shadow: 0 0 10px #c0392b; animation: slashAnim 0.3s forwards; }
Â  Â  Â  Â  @keyframes slashAnim { 0% { width: 0; opacity: 0; } 50% { width: 100%; opacity: 1; } 100% { width: 100%; opacity: 0; } }

Â  Â  Â  Â  .log-box { width: 100%; height: 120px; background: #f8f9fa; overflow-y: auto; padding: 10px; box-sizing: border-box; font-size: 12px; border-top: 1px solid #ccc; }
Â  Â  Â  Â  .log-entry { margin-bottom: 3px; border-bottom: 1px dashed #eee; padding-bottom: 2px; line-height: 1.4;}
Â  Â  Â  Â Â 
Â  Â  Â  Â  #rogueContainer { display: flex; flex-direction: row; justify-content: space-between; align-items: stretch; width: 100%; gap: 10px; margin-bottom: 20px;}
Â  Â  Â  Â  .rogue-card { flex: 1; border: 2px solid #ccc; border-radius: 8px; padding: 10px 5px; background: #fff; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1); position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.2s; }
Â  Â  Â  Â  .rogue-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
Â  Â  Â  Â  .rogue-card.selected { border: 3px solid #f1c40f; background: #fcf8e3; transform: scale(1.05); box-shadow: 0 0 15px rgba(241, 196, 15, 0.6); }
Â  Â  Â  Â  .card-icon { font-size: 32px; margin-bottom: 5px; }
Â  Â  Â  Â  .card-white { border-top: 5px solid #bdc3c7; }
Â  Â  Â  Â  .card-green { border-top: 5px solid #2ecc71; }
Â  Â  Â  Â  .card-blue { border-top: 5px solid #3498db; }
Â  Â  Â  Â  .card-purple { border-top: 5px solid #9b59b6; }
Â  Â  Â  Â  .card-orange { border-top: 5px solid #e67e22; }

Â  Â  </style>
</head>
<body>

<div id="gameContainer">
Â  Â Â 
Â  Â  <div id="startLayer" class="layer active layer-scroll">
Â  Â  Â  Â  <h1>å¤§çŒ«çŒ«æ–—æ¶é¾™</h1>
Â  Â  Â  Â  <div class="version">Ver3.08.12112501beta</div>
Â  Â  Â  Â  <svg width="150" height="150" viewBox="0 0 100 100">
Â  Â  Â  Â  Â  Â  <circle cx="50" cy="50" r="40" fill="#f1c40f" stroke="#e67e22" stroke-width="3"/>
Â  Â  Â  Â  Â  Â  <path d="M30 30 L40 10 L55 30 Z" fill="#f1c40f" stroke="#e67e22" stroke-width="2"/>
Â  Â  Â  Â  Â  Â  <path d="M70 30 L60 10 L45 30 Z" fill="#f1c40f" stroke="#e67e22" stroke-width="2"/>
Â  Â  Â  Â  Â  Â  <circle cx="35" cy="45" r="5" fill="#2c3e50"/>
Â  Â  Â  Â  Â  Â  <circle cx="65" cy="45" r="5" fill="#2c3e50"/>
Â  Â  Â  Â  Â  Â  <path d="M45 60 Q50 70 55 60" stroke="#c0392b" stroke-width="3" fill="none"/>
Â  Â  Â  Â  Â  Â  <path d="M10 50 L90 50" stroke="#bdc3c7" stroke-width="5" opacity="0.5"/>
Â  Â  Â  Â  </svg>
Â  Â  Â  Â  <br>
Â  Â  Â  Â  <button class="btn-green" onclick="openSlotMenu('load')" style="width:70%">è¯»å–å­˜æ¡£</button>
Â  Â  Â  Â  <button class="btn-blue" onclick="openSlotMenu('new')" style="width:70%">æ–°æ¸¸æˆ</button>
Â  Â  Â  Â  <button class="btn-gray" onclick="showLayer('changelog')" style="width:70%">æ›´æ–°æ—¥å¿—</button>
Â  Â  </div>

Â  Â  <div id="slotLayer" class="layer layer-scroll">
Â  Â  Â  Â  <h2 id="slotTitle">é€‰æ‹©å­˜æ¡£</h2>
Â  Â  Â  Â  <div id="slotList" class="slot-container"></div>
Â  Â  Â  Â  <button onclick="showLayer('start')" style="margin-top:20px; background:#95a5a6;">è¿”å›</button>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="nameInputLayer" class="layer">
Â  Â  Â  Â  <h2>åˆ›å»ºè§’è‰²</h2>
Â  Â  Â  Â  <input type="text" id="playerNameInput" placeholder="è¯·è¾“å…¥ä½ çš„å‹‡è€…å" maxlength="8">
Â  Â  Â  Â  <button onclick="goToClassSelection()">ä¸‹ä¸€æ­¥</button>
Â  Â  Â  Â  <button onclick="showLayer('start')" style="background:#95a5a6;">å–æ¶ˆ</button>
Â  Â  </div>

Â  Â  <div id="changelogLayer" class="layer layer-scroll">
Â  Â  Â  Â  <h2>æ›´æ–°æ—¥å¿—</h2>
Â  Â  Â  Â  <div class="scroll-box" id="changelogBox">
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 3.08.12112501beta</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">ç´§æ€¥ä¿®å¤</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="highlight">è‡´å‘½é”™è¯¯ä¿®å¤</span>ï¼šä¿®å¤äº†ç•Œé¢è·³è½¬é”®åé”™è¯¯å¯¼è‡´çš„æ¸¸æˆæ— æ³•å¼€å§‹çš„Bugã€‚ç°åœ¨[è¯»å–å­˜æ¡£]å’Œ[æ–°æ¸¸æˆ]å·²å®Œå…¨æ¢å¤æ­£å¸¸ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 3.06</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">æ ¸å¿ƒé€»è¾‘é‡æ„</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æœºæ¢°çŒ«ä¿®å¤ï¼šç©ºè“ä¸å†å¡æ­»ï¼Œç§»é™¤å–æ•´ï¼Œæ”¹ä¸ºæµ®ç‚¹è¿ç®—ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>å¤šå­˜æ¡£ä¿®å¤ï¼šä¿®å¤äº†æ–°æ¸¸æˆå¼€å§‹æ—¶å­˜æ¡£æ§½ä½æœªè¢«æ­£ç¡®é”å®šå¯¼è‡´æ— æ³•ä¿å­˜çš„é—®é¢˜ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ•°å€¼å¢å¼ºï¼šæœºæ¢°çŒ«ç«ç®­å¼¹ç³»æ•°æå‡ (0.25/0.75)ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ˜¾ç¤ºä¼˜åŒ–ï¼šæˆ˜æ–—æ—¥å¿—æ¢å¤å½©è‰²è¯¦ç»†æ˜¾ç¤ºï¼›ä¼¤å®³æ•°å­—ç§»è‡³å¤´é¡¶æ­£ä¸Šæ–¹ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 3.05</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">é‚ªé¾™é™ä¸´</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ–°å¢ç™¾å±‚BOSSã€é‚ªé¾™ã€‘ï¼Œæ‹¥æœ‰çœŸå®ä¼¤å®³é¾™æ¯ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ–°å¢æ€ªç‰©ç©¿é€æœºåˆ¶ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 3.04</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">ç‰ˆæœ¬ä¿®æ­£</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>ä¿®å¤ç‰ˆæœ¬å·æ··ä¹±ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ•´åˆç¾æœ¯èµ„æºã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 3.0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">èŒä¸šè§‰é†’</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ–°å¢è¡€éª‘çŒ«ã€æœºæ¢°çŒ«ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>å¡ç‰Œæ± é‡æ„ï¼Œæ–°å¢å”¯ä¸€å¡ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 2.1</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">å¤šå­˜æ¡£</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ”¯æŒ3ä¸ªç‹¬ç«‹å­˜æ¡£æ§½ä½ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 2.0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">å­˜æ¡£ç³»ç»Ÿ</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>æ–°å¢è‡ªåŠ¨/æ‰‹åŠ¨å­˜æ¡£åŠŸèƒ½ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â <div class="log-block">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-ver">Ver 1.0~1.9</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-date">æ—©æœŸç‰ˆæœ¬</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="log-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>åŸºç¡€ç©æ³•ä¸èŒä¸šæ„å»ºã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>å¡ç‰Œè‚‰é¸½ç³»ç»Ÿã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>SVGç¾æœ¯å‡çº§ã€‚</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button onclick="showLayer('start')">è¿”å›ä¸»ç•Œé¢</button>
Â  Â  </div>

Â  Â  <div id="classLayer" class="layer layer-scroll">
Â  Â  Â  Â  <h2 style="color:#2c3e50; font-size: 20px;">è¯·é€‰æ‹©ä½ çš„èŒä¸š</h2>
Â  Â  Â  Â  <div class="card-container" id="classContainer"></div>
Â  Â  Â  Â  <button onclick="showLayer('nameInputLayer')" style="margin-top:20px; background:#95a5a6;">è¿”å›</button>
Â  Â  </div>

Â  Â  <div id="battleLayer" class="layer">
Â  Â  Â  Â  <div class="cloud" style="top:20px; width:80px; height:30px; animation-duration:25s;"></div>
Â  Â  Â  Â  <div class="cloud" style="top:60px; width:120px; height:40px; animation-duration:35s; animation-delay:-10s"></div>

Â  Â  Â  Â  <button class="btn-home" onclick="goToMainMenu()" title="è¿”å›ä¸»èœå•">ğŸ </button>

Â  Â  Â  Â  <div class="battle-hud">
Â  Â  Â  Â  Â  Â  <div>ğŸ“ ç¬¬ <span id="levelText" style="color:#f1c40f; font-weight:bold">1</span> å±‚</div>
Â  Â  Â  Â  Â  Â  <div>ğŸ’€ å‡»æ€: <span id="killText">0</span></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="battle-scene">
Â  Â  Â  Â  Â  Â  <div id="playerEl" class="fighter">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="status-box">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="fighter-name" id="pName">å‹‡è€…</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-bg"><div class="hp-fill" id="pHpBar"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-bg" style="margin-top:1px; height:4px; border:none;"><div class="mp-fill" id="pMpBar"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:10px; color:#fff; text-shadow:1px 1px 0 #000;" id="pMpVal"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="pVisual" class="fighter-svg"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="enemyEl" class="fighter">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="status-box">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="fighter-name" id="eName">æ€ªç‰©</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-bg"><div class="hp-fill" id="eHpBar"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="eVisual" class="fighter-svg"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  Â  Â  <div class="tool-btn" onclick="showAttrPanel()" title="è§’è‰²å±æ€§">
Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" fill="#34495e"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="tool-btn" onclick="alert('èƒŒåŒ…ç³»ç»Ÿæš‚æœªå®è£…ï¼Œæ•¬è¯·æœŸå¾…ï¼')" title="èƒŒåŒ…">
Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" fill="#e67e22"><path d="M12 2l-5.5 9h11z"/><path d="M10 12h4v4h-4z"/><path d="M4 14v8h16v-8l-2-3H6z"/></svg>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="tool-btn" onclick="alert('è£…å¤‡ç³»ç»Ÿæš‚æœªå®è£…ï¼Œæ•¬è¯·æœŸå¾…ï¼')" title="è£…å¤‡">
Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" fill="#95a5a6"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="tool-btn" onclick="startDamageTest()" title="ä¼¤å®³æµ‹è¯•">
Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" fill="#c0392b"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-4h2v4zm2-6H8V9h6v2z"/></svg>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="tool-btn" onclick="saveGame(true)" title="ä¿å­˜è¿›åº¦">
Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24" fill="#2980b9"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="bottom-panel">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:2px;">
Â  Â  Â  Â  Â  Â  Â  Â  <span>EXP</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>LV.<span id="pLvVal">1</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="exp-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="exp-fill" id="expFill"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="exp-text" id="expText">0/2</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="log-box" id="battleLog">
Â  Â  Â  Â  Â  Â  <div class="log-entry">æ¬¢è¿æ¥åˆ°å¤§çŒ«çŒ«çš„ä¸–ç•Œ...</div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="cardLayer" class="layer layer-scroll">
Â  Â  Â  Â  <h2 style="color:#8e44ad; font-size:22px;">ğŸ å‘½è¿çš„é¦ˆèµ </h2>
Â  Â  Â  Â  <p style="color:#7f8c8d; font-size:12px; margin-bottom:15px;">è¯·ç‚¹å‡»å¡ç‰Œé€‰ä¸­ï¼Œç„¶åç¡®è®¤</p>
Â  Â  Â  Â  <div id="rogueContainer"></div>
Â  Â  Â  Â  <button id="confirmCardBtn" onclick="confirmRogueSelection()" disabled style="width:80%; margin-top:20px;">ç¡®è®¤é€‰æ‹©</button>
Â  Â  </div>

Â  Â  <div id="gameOverLayer" class="layer">
Â  Â  Â  Â  <h1 style="color: #c0392b;">ğŸ’” èƒœè´¥ä¹ƒå…µå®¶å¸¸äº‹</h1>
Â  Â  Â  Â  <p id="goReason" style="font-size:18px; color:#34495e;">åœ¨ç¬¬ X å±‚åŠ›ç«­å€’ä¸‹...</p>
Â  Â  Â  Â  <div style="font-size: 60px; margin: 30px;">ğŸš‘</div>
Â  Â  Â  Â  <p style="color:#7f8c8d; font-size:14px;">å¤§çŒ«çŒ«æ–½å±•äº†æ—¶é—´å›æº¯é­”æ³•ï¼<br>å±‚æ•°å›é€€5å±‚ï¼ŒçŠ¶æ€å›æ»¡ã€‚</p>
Â  Â  Â  Â  <button onclick="revivePlayer()" style="background:#2ecc71; box-shadow:0 4px 0 #27ae60">å¤æ´»å†æˆ˜</button>
Â  Â  </div>

Â  Â  <div id="attrLayer" class="layer layer-scroll">
Â  Â  Â  Â  <h2>è§’è‰²å±æ€§</h2>
Â  Â  Â  Â  <div class="scroll-box" style="margin-bottom:20px;">
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">åç§°</span><span class="attr-val" id="attrName">---</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">èŒä¸š</span><span class="attr-val" id="attrClass">---</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">ç­‰çº§</span><span class="attr-val" id="attrLvl">1</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">çŒ«è¡€ (HP)</span><span class="attr-val" id="attrHp">---</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">çŒ«èƒ½ (MP)</span><span class="attr-val" id="attrMp">---</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">çŒ«å¨ (Atk)</span><span class="attr-val" id="attrAtk">0</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">çŒ«å¾¡ (Def)</span><span class="attr-val" id="attrDef">0</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">çŒ«é€Ÿ (Spd)</span><span class="attr-val" id="attrSpd">0</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">æš´å‡»ç‡</span><span class="attr-val" id="attrCrit">0%</span></div>
Â  Â  Â  Â  Â  Â  <div class="attr-row"><span class="attr-label">æš´å‡»ä¼¤å®³</span><span class="attr-val" id="attrCritDmg">150%</span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button onclick="closeAttrPanel()">è¿”å›æˆ˜æ–—</button>
Â  Â  </div>

</div>

<script>
Â  Â  // --- 0. SVG ç»˜å›¾åº“ (ä¿æŒåŸæ ·) ---
Â  Â  const SVGS = {
Â  Â  Â  Â  cat_resolute: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><circle cx="40" cy="40" r="30" fill="#bdc3c7" stroke="#2c3e50" stroke-width="2"/><path d="M20 20 L10 0 L35 15 Z" fill="#bdc3c7" stroke="#2c3e50" stroke-width="2"/><path d="M60 20 L70 0 L45 15 Z" fill="#bdc3c7" stroke="#2c3e50" stroke-width="2"/><rect x="30" y="15" width="20" height="25" rx="5" fill="none" stroke="#2c3e50" stroke-width="2"/><line x1="40" y1="15" x2="40" y2="40" stroke="#2c3e50" stroke-width="1"/><line x1="30" y1="27" x2="50" y2="27" stroke="#2c3e50" stroke-width="1"/><path d="M65 40 L90 10" stroke="#95a5a6" stroke-width="6"/><path d="M65 40 L90 10" stroke="#2c3e50" stroke-width="2"/><line x1="60" y1="45" x2="70" y2="35" stroke="#f1c40f" stroke-width="4"/></g></svg>`,
Â  Â  Â  Â  cat_agile: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><circle cx="40" cy="40" r="30" fill="#f1c40f" stroke="#2c3e50" stroke-width="2"/><path d="M20 20 L10 0 L35 15 Z" fill="#f1c40f" stroke="#2c3e50" stroke-width="2"/><path d="M60 20 L70 0 L45 15 Z" fill="#f1c40f" stroke="#2c3e50" stroke-width="2"/><circle cx="30" cy="35" r="3" fill="#2c3e50"/><circle cx="50" cy="35" r="3" fill="#2c3e50"/><path d="M35 45 Q40 50 45 45" stroke="#2c3e50" stroke-width="2" fill="none"/><path d="M70 40 L85 25" stroke="#3498db" stroke-width="4"/><path d="M10 40 L-5 25" stroke="#3498db" stroke-width="4"/></g></svg>`,
Â  Â  Â  Â  cat_wise: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><circle cx="40" cy="40" r="30" fill="#9b59b6" stroke="#2c3e50" stroke-width="2"/><path d="M20 20 L10 0 L35 15 Z" fill="#9b59b6" stroke="#2c3e50" stroke-width="2"/><path d="M60 20 L70 0 L45 15 Z" fill="#9b59b6" stroke="#2c3e50" stroke-width="2"/><circle cx="30" cy="35" r="3" fill="#2c3e50"/><circle cx="50" cy="35" r="3" fill="#2c3e50"/><path d="M35 45 Q40 50 45 45" stroke="#2c3e50" stroke-width="2" fill="none"/><line x1="75" y1="20" x2="75" y2="80" stroke="#8e44ad" stroke-width="4"/><circle cx="75" cy="20" r="8" fill="#e74c3c"/></g></svg>`,
Â  Â  Â  Â  cat_berserk: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><circle cx="40" cy="40" r="30" fill="#c0392b" stroke="#2c3e50" stroke-width="2"/><path d="M20 20 L10 0 L35 15 Z" fill="#c0392b" stroke="#2c3e50" stroke-width="2"/><path d="M60 20 L70 0 L45 15 Z" fill="#c0392b" stroke="#2c3e50" stroke-width="2"/><line x1="25" y1="30" x2="35" y2="38" stroke="#000" stroke-width="2"/><line x1="55" y1="30" x2="45" y2="38" stroke="#000" stroke-width="2"/><path d="M35 50 Q40 45 45 50" stroke="#2c3e50" stroke-width="2" fill="none"/><path d="M80 40 L80 70 M70 40 L90 40 L80 50 Z" fill="#7f8c8d" stroke="#000" stroke-width="1"/><path d="M0 40 L0 70 M-10 40 L10 40 L0 50 Z" fill="#7f8c8d" stroke="#000" stroke-width="1"/></g></svg>`,
Â  Â  Â  Â  cat_blood: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><circle cx="40" cy="40" r="30" fill="#2c3e50" stroke="#c0392b" stroke-width="2"/><path d="M20 20 L10 0 L35 15 Z" fill="#2c3e50" stroke="#c0392b" stroke-width="2"/><path d="M60 20 L70 0 L45 15 Z" fill="#2c3e50" stroke="#c0392b" stroke-width="2"/><path d="M25 35 Q30 25 35 35" stroke="#e74c3c" stroke-width="3" fill="none"/><path d="M45 35 Q50 25 55 35" stroke="#e74c3c" stroke-width="3" fill="none"/><circle cx="30" cy="38" r="2" fill="#e74c3c"/><circle cx="50" cy="38" r="2" fill="#e74c3c"/><path d="M70 50 Q80 20 50 10" stroke="#c0392b" stroke-width="4" fill="none"/><line x1="70" y1="50" x2="80" y2="80" stroke="#95a5a6" stroke-width="3"/></g></svg>`,
Â  Â  Â  Â  cat_mech: `<svg viewBox="0 0 100 100"><g transform="translate(10,10)"><path d="M15 20 L65 20 L75 35 L75 70 L50 80 L25 70 L5 70 L5 35 Z" fill="#7f8c8d" stroke="#34495e" stroke-width="2"/><rect x="15" y="35" width="50" height="10" fill="#3498db"/><line x1="10" y1="20" x2="5" y2="0" stroke="#34495e" stroke-width="3"/><line x1="70" y1="20" x2="75" y2="0" stroke="#34495e" stroke-width="3"/><rect x="75" y="50" width="20" height="10" fill="#2c3e50"/><circle cx="95" cy="55" r="3" fill="#e74c3c"/></g></svg>`,
Â  Â  Â  Â  monster_slime: `<svg viewBox="0 0 100 100"><path d="M20 80 Q20 20 50 20 Q80 20 80 80 Z" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/><circle cx="40" cy="50" r="5" fill="#000"/><circle cx="60" cy="50" r="5" fill="#000"/></svg>`,
Â  Â  Â  Â  monster_bat: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="15" fill="#34495e"/><path d="M35 50 Q10 20 10 50 Q20 70 35 55" fill="#34495e"/><path d="M65 50 Q90 20 90 50 Q80 70 65 55" fill="#34495e"/><circle cx="45" cy="50" r="2" fill="#e74c3c"/><circle cx="55" cy="50" r="2" fill="#e74c3c"/></svg>`,
Â  Â  Â  Â  monster_dragon: `<svg viewBox="0 0 100 100"><path d="M30 60 Q30 30 50 20 Q70 30 70 60" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/><path d="M50 20 L50 5" stroke="#e74c3c" stroke-width="4"/><circle cx="40" cy="45" r="4" fill="#f1c40f"/><circle cx="60" cy="45" r="4" fill="#f1c40f"/><path d="M40 70 Q50 80 60 70" stroke="#000" stroke-width="2" fill="none"/></svg>`,
Â  Â  Â  Â  monster_evil_dragon: `<svg viewBox="0 0 100 100"><path d="M20 70 Q40 20 80 30 Q90 50 70 80 Q50 90 20 70 Z" fill="#2c3e50" stroke="#000" stroke-width="2"/><path d="M80 30 Q95 10 90 5 Q70 15 60 35" fill="#c0392b"/><path d="M30 40 Q40 50 30 60" stroke="#c0392b" stroke-width="3" fill="none"/><circle cx="65" cy="45" r="3" fill="#e74c3c"/><circle cx="75" cy="55" r="3" fill="#e74c3c"/><path d="M10 60 Q20 40 10 20" stroke="#2c3e50" stroke-width="4" fill="none"/></svg>`,
Â  Â  Â  Â  stake: `<svg viewBox="0 0 100 100"><rect x="35" y="20" width="30" height="70" fill="#d35400" stroke="#5d4037" stroke-width="2"/><circle cx="50" cy="40" r="8" fill="#fff" opacity="0.8"/><circle cx="50" cy="40" r="3" fill="#000"/><path d="M35 20 L50 5 L65 20 Z" fill="#d35400" stroke="#5d4037" stroke-width="2"/></svg>`
Â  Â  };

Â  Â  const CLASSES = [
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'resolute', name: 'åšæ¯…çŒ«', svg: SVGS.cat_resolute, color: '#95a5a6',
Â  Â  Â  Â  Â  Â  base: { atk: 32, mp: 5, def: 25, hp: 200, spd: 10 },
Â  Â  Â  Â  Â  Â  growth: { atk: 3, mp: 1, def: 15, hp: 50, spd: 1 },
Â  Â  Â  Â  Â  Â  talent: 'ã€è†æ£˜ç”²å£³ã€‘è‹¥[çŒ«å¾¡]â‰¥[çŒ«å¨]x2åå¼¹[çŒ«å¾¡]x1ä¼¤å®³ï¼›è‹¥â‰¥x5ï¼Œåå¼¹[çŒ«å¾¡]x2+[çŒ«è¡€]x0.2ä¼¤å®³ã€‚åä¼¤å¯è§¦å‘æš´å‡»ã€‚'
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'agile', name: 'çµæ´»çŒ«', svg: SVGS.cat_agile, color: '#f1c40f',
Â  Â  Â  Â  Â  Â  base: { atk: 40, mp: 8, def: 10, hp: 80, spd: 20 },
Â  Â  Â  Â  Â  Â  growth: { atk: 10, mp: 2, def: 3, hp: 20, spd: 4 },
Â  Â  Â  Â  Â  Â  talent: 'ã€è¿…æ·è¿å‡»ã€‘æ”»å‡»åè¿½åŠ ä¸€æ®µ[çŒ«é€Ÿ]x1çš„çœŸå®ä¼¤å®³(ä¸çˆ†å‡»)ã€‚æ¯å‡10çº§ç³»æ•°+0.2ã€‚'
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'wise', name: 'æ™ºæ…§çŒ«', svg: SVGS.cat_wise, color: '#9b59b6',
Â  Â  Â  Â  Â  Â  base: { atk: 45, mp: 20, def: 10, hp: 70, spd: 10 },
Â  Â  Â  Â  Â  Â  growth: { atk: 15, mp: 10, def: 3, hp: 18, spd: 2 },
Â  Â  Â  Â  Â  Â  talent: 'ã€å¥¥æœ¯è¶…è½½ã€‘æ¶ˆè€—10%[çŒ«èƒ½]å¢ä¼¤ï¼Œ1ç‚¹[çŒ«èƒ½]å¢åŠ 1%ä¼¤å®³ã€‚è‡´æ­»æ—¶æ¶ˆè€—[çŒ«èƒ½]æŠµæŒ¡ä¼¤å®³(å•åœºé™1æ¬¡)ã€‚'
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'berserk', name: 'ç‹‚æš´çŒ«', svg: SVGS.cat_berserk, color: '#c0392b',
Â  Â  Â  Â  Â  Â  base: { atk: 50, mp: 6, def: 8, hp: 100, spd: 15 },
Â  Â  Â  Â  Â  Â  growth: { atk: 20, mp: 1, def: 3, hp: 25, spd: 2 },
Â  Â  Â  Â  Â  Â  talent: 'ã€é²œè¡€æ¸´æœ›ã€‘æ¶ˆè€—20%[çŒ«è¡€]æ”»å‡»ï¼Œè¡€è¶Šå°‘ä¼¤è¶Šé«˜ï¼Œå¸¦10%å¸è¡€ã€‚'
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'blood', name: 'è¡€éª‘çŒ«', svg: SVGS.cat_blood, color: '#8e44ad',
Â  Â  Â  Â  Â  Â  base: { atk: 25, mp: 6, def: 12, hp: 200, spd: 10 },
Â  Â  Â  Â  Â  Â  growth: { atk: 12, mp: 1, def: 3, hp: 50, spd: 1 },
Â  Â  Â  Â  Â  Â  talent: 'ã€é­”è¡€å¥”æ¶Œã€‘æ¯ç§’ç¼çƒ§æ•Œæ–¹([çŒ«å¨]x0.8+[çŒ«è¡€]x0.2)ç‚¹çœŸå®ä¼¤å®³ï¼Œè¯¥ä¼¤å®³ä¸å¯çˆ†å‡»ã€‚'
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  id: 'mech', name: 'æœºæ¢°çŒ«', svg: SVGS.cat_mech, color: '#34495e',
Â  Â  Â  Â  Â  Â  base: { atk: 30, mp: 12, def: 25, hp: 120, spd: 0 },
Â  Â  Â  Â  Â  Â  growth: { atk: 15, mp: 4, def: 3, hp: 20, spd: 0 },
Â  Â  Â  Â  Â  Â  talent: 'ã€CAAATÎ©ç«ç®­å¼¹ã€‘æ— æ³•æ™®æ”»/äº«å—çŒ«é€Ÿã€‚æ¯0.2ç§’æ¶ˆè€—3%å½“å‰[çŒ«èƒ½]é€ æˆ[çŒ«å¨]x0.25+å‰©ä½™[çŒ«èƒ½]x0.75ä¼¤å®³ï¼Œå¯çˆ†å‡»ã€‚'
Â  Â  Â  Â  }
Â  Â  ];

Â  Â  const CARDS = [
Â  Â  Â  Â  { type: 'white', icon: 'âš”ï¸', title: 'åŠ›é‡è®­ç»ƒ', desc: 'çŒ«å¨ +10', effect: (p) => { p.atk += 10; } },
Â  Â  Â  Â  { type: 'white', icon: 'â¤ï¸', title: 'ä½“èƒ½å¼ºåŒ–', desc: 'çŒ«è¡€ +60', effect: (p) => { p.maxHp += 60; p.hp += 60; } },
Â  Â  Â  Â  { type: 'white', icon: 'ğŸ›¡ï¸', title: 'ç¡¬åŒ–çš®æ¯›', desc: 'çŒ«å¾¡ +10', effect: (p) => { p.def += 10; } },
Â  Â  Â  Â  { type: 'white', icon: 'âš¡', title: 'æ•æ·æ­¥ä¼', desc: 'çŒ«é€Ÿ +5', effect: (p) => { p.spd += 5; } },
Â  Â  Â  Â  { type: 'white', icon: 'ğŸ’§', title: 'å†¥æƒ³', desc: 'çŒ«èƒ½ +5', effect: (p) => { p.mp += 5; p.maxMp += 5; } },
Â  Â  Â  Â Â 
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ¯', title: 'å¼±ç‚¹çœ‹ç ´', desc: 'æš´å‡»ç‡ +5%', effect: (p) => { p.critRate += 0.05; } },
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ’¥', title: 'è‡´å‘½ä¸€å‡»', desc: 'çˆ†ä¼¤ +10%', effect: (p) => { p.critDmg += 0.1; } },
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ’š', title: 'ç”Ÿå‘½æºæ³‰', desc: 'çŒ«è¡€ +200', effect: (p) => { p.maxHp += 200; p.hp += 200; } },
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ”°', title: 'é’¢é“æ„å¿—', desc: 'çŒ«å¾¡ +40', effect: (p) => { p.def += 40; } },
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ‘Ÿ', title: 'æé€Ÿ', desc: 'çŒ«é€Ÿ +12', effect: (p) => { p.spd += 12; } },
Â  Â  Â  Â  { type: 'green', icon: 'ğŸ§ª', title: 'é­”åŠ›æ‰©å®¹', desc: 'çŒ«èƒ½ +15', effect: (p) => { p.mp += 15; p.maxMp += 15; } },
Â  Â  Â  Â Â 
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸ‘ï¸', title: 'é¹°çœ¼', desc: 'æš´å‡» +8%', effect: (p) => { p.critRate += 0.08; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸ’£', title: 'æ¯ç­æ‰“å‡»', desc: 'çˆ†ä¼¤ +20%', effect: (p) => { p.critDmg += 0.2; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸ’—', title: 'æ³°å¦ä¹‹å¿ƒ', desc: 'çŒ«è¡€ +500', effect: (p) => { p.maxHp += 500; p.hp += 500; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸ°', title: 'ä¸åŠ¨å¦‚å±±', desc: 'çŒ«å¾¡ +80', effect: (p) => { p.def += 80; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸš€', title: 'å…‰é€Ÿ', desc: 'çŒ«é€Ÿ +20', effect: (p) => { p.spd += 20; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, icon: 'ğŸŒŒ', title: 'è™šç©ºé­”èƒ½', desc: 'çŒ«èƒ½ +30', effect: (p) => { p.mp += 30; p.maxMp += 30; } },
Â  Â  Â  Â Â 
Â  Â  Â  Â  { type: 'blue', minLvl: 100, unique: true, id: 'heal_kill', icon: 'ğŸ§›', title: 'ä»¥æˆ˜å…»æˆ˜', desc: 'èƒœåˆ©å›å¤60%æŸè€—', effect: (p) => { p.hasHealKill = true; } },
Â  Â  Â  Â  { type: 'blue', minLvl: 100, unique: true, id: 'low_hp_spd', icon: 'ğŸ”¥', title: 'èƒŒæ°´ä¸€æˆ˜', desc: 'ä½è¡€é‡åŠ çŒ«é€Ÿ', effect: (p) => { p.hasLowHpSpd = true; } },
Â  Â  ];

Â  Â  let player = null;
Â  Â  let enemy = null;
Â  Â  let gameLevel = 1;
Â  Â  let killCount = 0;
Â  Â  let stageCount = 0;Â 
Â  Â  let stageType = 'minion';Â 
Â  Â  let isPlayerTurn = true;
Â  Â  let isPendingRogue = false;
Â  Â  let selectedRogueCard = null;
Â  Â  let isFirstRogue = false;
Â  Â  let isGameActive = false;
Â  Â  let currentSlotId = null;
Â  Â  let lastBossType = null;Â 
Â  Â Â 
Â  Â  let bloodInterval = null;
Â  Â  let mechInterval = null;
Â  Â Â 
Â  Â  let isTestingDamage = false;
Â  Â  let testTimer = 0;
Â  Â  let testTotalDamage = 0;
Â  Â  let testInterval = null;

Â  Â  const layers = {
Â  Â  Â  Â  start: document.getElementById('startLayer'),
Â  Â  Â  Â  slot: document.getElementById('slotLayer'),
Â  Â  Â  Â  name: document.getElementById('nameInputLayer'),
Â  Â  Â  Â  select: document.getElementById('classLayer'),
Â  Â  Â  Â  battle: document.getElementById('battleLayer'),
Â  Â  Â  Â  card: document.getElementById('cardLayer'),
Â  Â  Â  Â  over: document.getElementById('gameOverLayer'),
Â  Â  Â  Â  changelog: document.getElementById('changelogLayer'),
Â  Â  Â  Â  attr: document.getElementById('attrLayer')
Â  Â  };
Â  Â  const logs = document.getElementById('battleLog');

Â  Â  // --- 0. åˆå§‹åŒ–æ£€æµ‹å­˜æ¡£ ---
Â  Â  window.onload = function() {
Â  Â  Â  Â  const legacySave = localStorage.getItem('bigCatQuestSave');
Â  Â  Â  Â  const slot0 = localStorage.getItem('bigCatQuest_slot_0');
Â  Â  Â  Â  if (legacySave && !slot0) {
Â  Â  Â  Â  Â  Â  localStorage.setItem('bigCatQuest_slot_0', legacySave);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const slider = document.getElementById('changelogBox');
Â  Â  Â  Â  let isDown = false; let startY; let scrollTop;
Â  Â  Â  Â  if (slider) {
Â  Â  Â  Â  Â  Â  slider.addEventListener('mousedown', (e) => { isDown = true; startY = e.pageY - slider.offsetTop; scrollTop = slider.scrollTop; });
Â  Â  Â  Â  Â  Â  slider.addEventListener('mouseleave', () => { isDown = false; });
Â  Â  Â  Â  Â  Â  slider.addEventListener('mouseup', () => { isDown = false; });
Â  Â  Â  Â  Â  Â  slider.addEventListener('mousemove', (e) => { if (!isDown) return; e.preventDefault(); const y = e.pageY - slider.offsetTop; const walk = (y - startY) * 2; slider.scrollTop = scrollTop - walk; });
Â  Â  Â  Â  }
Â  Â  };

Â  Â  function showLayer(name) {
Â  Â  Â  Â  Object.values(layers).forEach(l => {
Â  Â  Â  Â  Â  Â  if(l) l.classList.remove('active');
Â  Â  Â  Â  });
Â  Â  Â  Â  if(layers[name]) layers[name].classList.add('active');
Â  Â  Â  Â  else console.error("Layer not found: " + name);
Â  Â  }

Â  Â  function log(msg, color = '#333') {
Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  div.className = 'log-entry';
Â  Â  Â  Â  div.innerHTML = msg;
Â  Â  Â  Â  div.style.color = color;
Â  Â  Â  Â  logs.appendChild(div);
Â  Â  Â  Â  logs.scrollTop = logs.scrollHeight;
Â  Â  }

Â  Â  function floatText(text, targetEl, color='red', fontSize='22px') {
Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  el.className = 'floating-text';
Â  Â  Â  Â  el.innerText = text;
Â  Â  Â  Â  el.style.color = color;
Â  Â  Â  Â  el.style.fontSize = fontSize;
Â  Â  Â  Â  el.style.marginLeft = '0px';Â 
Â  Â  Â  Â  targetEl.appendChild(el);
Â  Â  Â  Â  setTimeout(() => el.remove(), 800);
Â  Â  }

Â  Â  function showSlash(targetEl) {
Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  el.className = 'slash-effect';
Â  Â  Â  Â  targetEl.appendChild(el);
Â  Â  Â  Â  setTimeout(() => el.remove(), 300);
Â  Â  }

Â  Â  let slotMode = 'load';

Â  Â  function openSlotMenu(mode) {
Â  Â  Â  Â  slotMode = mode;
Â  Â  Â  Â  const container = document.getElementById('slotList');
Â  Â  Â  Â  const title = document.getElementById('slotTitle');
Â  Â  Â  Â  title.innerText = mode === 'load' ? "è¯»å–å­˜æ¡£" : "é€‰æ‹©å­˜æ¡£æ§½ä½";
Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  for(let i=0; i<3; i++) {
Â  Â  Â  Â  Â  Â  const saveStr = localStorage.getItem(`bigCatQuest_slot_${i}`);
Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  el.className = 'save-slot';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (saveStr) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(saveStr);
Â  Â  Â  Â  Â  Â  Â  Â  const cls = CLASSES.find(c => c.id === data.clsId);
Â  Â  Â  Â  Â  Â  Â  Â  const clsIcon = cls ? cls.svg : 'â“';
Â  Â  Â  Â  Â  Â  Â  Â  const clsName = cls ? cls.name : 'æœªçŸ¥';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-icon">${clsIcon}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-title">${clsName} <span style="font-size:12px; color:#27ae60">Lv.${data.player.lvl}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-detail">ç¬¬ ${data.gameLevel} å±‚ | ${data.timestamp.split(' ')[0]}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  const delBtn = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  delBtn.innerHTML = 'ğŸ—‘ï¸';
Â  Â  Â  Â  Â  Â  Â  Â  delBtn.className = 'delete-btn';
Â  Â  Â  Â  Â  Â  Â  Â  delBtn.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿ")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem(`bigCatQuest_slot_${i}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openSlotMenu(mode);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  el.appendChild(delBtn);

Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'load') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSlotId = i;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadGameFromSlot(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(confirm("è¯¥æ§½ä½å·²æœ‰å­˜æ¡£ï¼Œç¡®å®šè¦†ç›–å—ï¼Ÿ")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSlotId = i;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLayer('name'); // ID is nameInputLayer, defined as 'name' in layers
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  el.className += ' empty';
Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = '<div>+ ç©ºæ§½ä½</div>';
Â  Â  Â  Â  Â  Â  Â  Â  el.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSlotId = i;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'load') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLayer('name');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLayer('name');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  }
Â  Â  Â  Â  showLayer('slot');
Â  Â  }

Â  Â  function goToClassSelection() {
Â  Â  Â  Â  const name = document.getElementById('playerNameInput').value.trim();
Â  Â  Â  Â  if (!name) { alert("å¤§ä¾ è¯·ç•™åï¼"); return; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const container = document.getElementById('classContainer');
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  CLASSES.forEach(cls => {
Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  card.className = 'class-card';
Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="svg-icon">${cls.svg}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color:${cls.color}">${cls.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats-text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å¨: ${cls.base.atk} <span style="color:#27ae60">(+${cls.growth.atk})</span> èƒ½: ${cls.base.mp} <span style="color:#27ae60">(+${cls.growth.mp})</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å¾¡: ${cls.base.def} <span style="color:#27ae60">(+${cls.growth.def})</span> è¡€: ${cls.base.hp} <span style="color:#27ae60">(+${cls.growth.hp})</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  é€Ÿ: ${cls.base.spd} <span style="color:#27ae60">(+${cls.growth.spd})</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="talent-text">${cls.talent}</div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  card.onclick = () => initGame(name, cls);
Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  });
Â  Â  Â  Â  showLayer('select');
Â  Â  }

Â  Â  function initGame(name, cls) {
Â  Â  Â  Â  player = {
Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  cls: cls,
Â  Â  Â  Â  Â  Â  lvl: 1,
Â  Â  Â  Â  Â  Â  exp: 0,
Â  Â  Â  Â  Â  Â  maxExp: 2,
Â  Â  Â  Â  Â  Â  maxHp: cls.base.hp, hp: cls.base.hp,
Â  Â  Â  Â  Â  Â  maxMp: cls.base.mp, mp: cls.base.mp,
Â  Â  Â  Â  Â  Â  atk: cls.base.atk, def: cls.base.def, spd: cls.base.spd,
Â  Â  Â  Â  Â  Â  critRate: 0, critDmg: 1.5,
Â  Â  Â  Â  Â  Â  shieldUsed: false,
Â  Â  Â  Â  Â  Â  uniqueCards: [],
Â  Â  Â  Â  Â  Â  hasHealKill: false,
Â  Â  Â  Â  Â  Â  hasLowHpSpd: false
Â  Â  Â  Â  };
Â  Â  Â  Â  gameLevel = 1;
Â  Â  Â  Â  killCount = 0;
Â  Â  Â  Â  stageCount = 0;
Â  Â  Â  Â  stageType = 'minion';
Â  Â  Â  Â  lastBossType = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('pName').innerText = player.name;
Â  Â  Â  Â  document.getElementById('pVisual').innerHTML = cls.svg;
Â  Â  Â  Â Â 
Â  Â  Â  Â  saveGame();
Â  Â  Â  Â  log("å†’é™©å¼€å§‹ï¼", '#f39c12');
Â  Â  Â  Â  showRogueSelection(true);Â 
Â  Â  }

Â  Â  function saveGame(manual = false) {
Â  Â  Â  Â  if (!player || currentSlotId === null) return;
Â  Â  Â  Â  const saveData = {
Â  Â  Â  Â  Â  Â  player: player,
Â  Â  Â  Â  Â  Â  clsId: player.cls.id,Â 
Â  Â  Â  Â  Â  Â  gameLevel: gameLevel,
Â  Â  Â  Â  Â  Â  killCount: killCount,
Â  Â  Â  Â  Â  Â  stageCount: stageCount,
Â  Â  Â  Â  Â  Â  stageType: stageType,
Â  Â  Â  Â  Â  Â  lastBossType: lastBossType,
Â  Â  Â  Â  Â  Â  timestamp: new Date().toLocaleString()
Â  Â  Â  Â  };
Â  Â  Â  Â  localStorage.setItem(`bigCatQuest_slot_${currentSlotId}`, JSON.stringify(saveData));
Â  Â  Â  Â  if (manual) { alert("å­˜æ¡£æˆåŠŸï¼"); }Â 
Â  Â  }

Â  Â  function loadGame() {
Â  Â  Â  Â  openSlotMenu('load');
Â  Â  }

Â  Â  function loadGameFromSlot(data) {
Â  Â  Â  Â  player = data.player;
Â  Â  Â  Â  player.cls = CLASSES.find(c => c.id === data.clsId);
Â  Â  Â  Â  gameLevel = data.gameLevel;
Â  Â  Â  Â  killCount = data.killCount;
Â  Â  Â  Â  stageCount = data.stageCount;
Â  Â  Â  Â  stageType = data.stageType;
Â  Â  Â  Â  lastBossType = data.lastBossType || null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(player.critRate === undefined) player.critRate = 0;
Â  Â  Â  Â  if(player.critDmg === undefined) player.critDmg = 1.5;
Â  Â  Â  Â  if(player.uniqueCards === undefined) player.uniqueCards = [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('pName').innerText = player.name;
Â  Â  Â  Â  document.getElementById('pVisual').innerHTML = player.cls.svg;
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  showLayer('battle');
Â  Â  Â  Â  log("ã€ç³»ç»Ÿã€‘æ¬¢è¿å›æ¥ï¼Œå†’é™©ç»§ç»­ï¼", '#27ae60');
Â  Â  Â  Â  startNextBattle();
Â  Â  }

Â  Â  function goToMainMenu() {
Â  Â  Â  Â  if(confirm("ç¡®å®šè¦è¿”å›ä¸»èœå•å—ï¼Ÿè¿›åº¦å°†è‡ªåŠ¨ä¿å­˜ã€‚")) {
Â  Â  Â  Â  Â  Â  saveGame();
Â  Â  Â  Â  Â  Â  isGameActive = false;
Â  Â  Â  Â  Â  Â  if(bloodInterval) clearInterval(bloodInterval);
Â  Â  Â  Â  Â  Â  if(mechInterval) clearInterval(mechInterval);
Â  Â  Â  Â  Â  Â  showLayer('start');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function startNextBattle() {
Â  Â  Â  Â  isGameActive = true;
Â  Â  Â  Â  if(bloodInterval) clearInterval(bloodInterval);
Â  Â  Â  Â  if(mechInterval) clearInterval(mechInterval);

Â  Â  Â  Â  if (isPendingRogue) {
Â  Â  Â  Â  Â  Â  isPendingRogue = false;
Â  Â  Â  Â  Â  Â  showRogueSelection();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  player.shieldUsed = false;Â 
Â  Â  Â  Â  generateEnemy();
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let titleColor = '#3498db';
Â  Â  Â  Â  if (stageType === 'evil_dragon') titleColor = '#c0392b';
Â  Â  Â  Â  log(`<br><strong style="color:${titleColor}">=== ç¬¬ ${gameLevel} å±‚ ===</strong>`);
Â  Â  Â  Â  log(`é­é‡äº† ${enemy.name}!`, '#e74c3c');

Â  Â  Â  Â  if (player.cls.id === 'blood') {
Â  Â  Â  Â  Â  Â  log("[é­”è¡€å¥”æ¶Œ] å¼€å¯ï¼Œæ¯ç§’ç¼çƒ§æ•Œäººï¼", "#8e44ad");
Â  Â  Â  Â  Â  Â  bloodInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!isGameActive) return;
Â  Â  Â  Â  Â  Â  Â  Â  if (player.hp > 0 && enemy.hp > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let dot = Math.floor(player.atk * 0.8 + player.hp * 0.2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enemy.hp -= dot;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  floatText(`-${dot}`, document.getElementById('enemyEl'), '#8e44ad', '20px');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (enemy.hp <= 0) checkResult();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (player.cls.id === 'mech') {
Â  Â  Â  Â  Â  Â  log("[CAAATÎ©ç«ç®­å¼¹] å¯åŠ¨ï¼Œå¼¹å¹•å‹åˆ¶ï¼", "#34495e");
Â  Â  Â  Â  Â  Â  mechInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!isGameActive) return;
Â  Â  Â  Â  Â  Â  Â  Â  if (player.hp > 0 && enemy.hp > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cost = Math.floor(player.mp * 0.02);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (player.mp > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.mp -= cost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(player.mp < 0) player.mp = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let dmgBase = player.atk * 0.25 + player.mp * 0.75;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let isCrit = Math.random() < player.critRate;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let finalDmg = Math.max(1, Math.floor(dmgBase * (isCrit ? player.critDmg : 1)));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enemy.hp -= finalDmg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let color = isCrit ? '#e74c3c' : '#fff';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isCrit) log(`[Î©ç«ç®­] æš´å‡»! é€ æˆ ${finalDmg} ä¼¤å®³`, '#c0392b');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  floatText(finalDmg, document.getElementById('enemyEl'), color, '16px');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (enemy.hp <= 0) checkResult();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let charge = Math.max(1, Math.floor(player.maxMp * 0.05));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.mp += charge;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  log(`[ç³»ç»Ÿ] èƒ½æºè€—å°½ï¼Œç´§æ€¥å……èƒ½ ${charge} ç‚¹`, '#2980b9');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 200);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (player.cls.id !== 'mech') {
Â  Â  Â  Â  Â  Â  let effectiveSpd = player.spd;
Â  Â  Â  Â  Â  Â  if (player.hasLowHpSpd) {
Â  Â  Â  Â  Â  Â  Â  Â  let missingPct = (player.maxHp - player.hp) / player.maxHp;
Â  Â  Â  Â  Â  Â  Â  Â  let boost = Math.min(0.6, missingPct);
Â  Â  Â  Â  Â  Â  Â  Â  effectiveSpd = Math.floor(player.spd * (1 + boost));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  isPlayerTurn = effectiveSpd >= enemy.spd;
Â  Â  Â  Â  Â  Â  setTimeout(battleLoop, 800);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  setTimeout(battleLoop, 800);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function generateEnemy() {
Â  Â  Â  Â  if (gameLevel % 100 === 0) {
Â  Â  Â  Â  Â  Â  stageType = 'evil_dragon';
Â  Â  Â  Â  Â  Â  stageCount = 0;Â 
Â  Â  Â  Â  } else if (stageCount >= 5) {
Â  Â  Â  Â  Â  Â  if (stageType === 'minion') stageType = 'elite';Â 
Â  Â  Â  Â  } else { stageType = 'minion'; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (stageType === 'boss' || stageType === 'evil_dragon') { stageType = 'minion'; stageCount = 0; }
Â  Â  Â  Â  if (!player.eliteKills) player.eliteKills = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (gameLevel % 100 === 0) {
Â  Â  Â  Â  Â  Â  stageType = 'evil_dragon';
Â  Â  Â  Â  } else if (stageCount >= 5) {
Â  Â  Â  Â  Â  Â  if ((player.eliteKills + 1) % 5 === 0 && player.eliteKills > 0) stageType = 'boss';
Â  Â  Â  Â  Â  Â  else stageType = 'elite';
Â  Â  Â  Â  }

Â  Â  Â  Â  let baseHp = 80 + (gameLevel * 25);
Â  Â  Â  Â  let baseAtk = 15 + (gameLevel * 4);
Â  Â  Â  Â  let baseDef = 5 + (gameLevel * 1);Â 
Â  Â  Â  Â  let baseSpd = 10 + (gameLevel * 1.5);Â 

Â  Â  Â  Â  let typeName = 'å°æ€ª';
Â  Â  Â  Â  let svg = SVGS.monster_slime;
Â  Â  Â  Â  let hpMult = 1.0, atkMult = 1.0, defMult = 1.0;

Â  Â  Â  Â  if (stageType === 'elite') {Â 
Â  Â  Â  Â  Â  Â  typeName = 'ã€ç²¾è‹±ã€‘'; svg = SVGS.monster_bat; hpMult = 2.5; atkMult = 1.3; defMult = 1.2;Â 
Â  Â  Â  Â  } else if (stageType === 'boss') {Â 
Â  Â  Â  Â  Â  Â  typeName = 'ã€é­”ç‹ã€‘'; svg = SVGS.monster_dragon; hpMult = 5.5; atkMult = 1.5; defMult = 1.4;Â 
Â  Â  Â  Â  } else if (stageType === 'evil_dragon') {
Â  Â  Â  Â  Â  Â  typeName = 'ã€é‚ªé¾™ã€‘'; svg = SVGS.monster_evil_dragon; hpMult = 7.0; atkMult = 1.7; defMult = 1.6;
Â  Â  Â  Â  Â  Â  log("ä¸€è‚¡è¿œå¤çš„é‚ªæ¶æ°”æ¯æ‰‘é¢è€Œæ¥...", "#c0392b");
Â  Â  Â  Â  }

Â  Â  Â  Â  enemy = {
Â  Â  Â  Â  Â  Â  name: typeName,
Â  Â  Â  Â  Â  Â  type: stageType,Â 
Â  Â  Â  Â  Â  Â  maxHp: Math.floor(baseHp * hpMult * (0.9 + Math.random()*0.2)),
Â  Â  Â  Â  Â  Â  hp: 0,
Â  Â  Â  Â  Â  Â  atk: Math.floor(baseAtk * atkMult),
Â  Â  Â  Â  Â  Â  def: Math.floor(baseDef * defMult),
Â  Â  Â  Â  Â  Â  spd: Math.floor(baseSpd),
Â  Â  Â  Â  Â  Â  visual: svg
Â  Â  Â  Â  };
Â  Â  Â  Â  enemy.hp = enemy.maxHp;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('eName').innerText = enemy.name;
Â  Â  Â  Â  document.getElementById('eVisual').innerHTML = enemy.visual;
Â  Â  }

Â  Â  function battleLoop() {
Â  Â  Â  Â  if (!isGameActive) return;
Â  Â  Â  Â  if (!isTestingDamage && (player.hp <= 0 || enemy.hp <= 0)) return;
Â  Â  Â  Â  if (isTestingDamage && enemy.hp <= 0) enemy.hp = enemy.maxHp;
Â  Â  Â  Â  if (isTestingDamage && player.hp <= 0) player.hp = 1;Â 

Â  Â  Â  Â  if (player.cls.id === 'mech') {
Â  Â  Â  Â  Â  Â  performEnemyAttack();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (isPlayerTurn) performPlayerAttack();
Â  Â  Â  Â  Â  Â  else performEnemyAttack();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function performPlayerAttack() {
Â  Â  Â  Â  const pEl = document.getElementById('playerEl');
Â  Â  Â  Â  pEl.style.transform = 'translateX(30px)';
Â  Â  Â  Â  setTimeout(() => pEl.style.transform = 'translateX(0)', 200);
Â  Â  Â  Â  showSlash(document.getElementById('enemyEl'));

Â  Â  Â  Â  if (player.cls.id === 'wise') {
Â  Â  Â  Â  Â  Â  let rec = Math.ceil(player.maxMp * 0.05);
Â  Â  Â  Â  Â  Â  player.mp = Math.min(player.maxMp, player.mp + rec);
Â  Â  Â  Â  }

Â  Â  Â  Â  let dmgMult = 1.0;
Â  Â  Â  Â  let extraDmg = 0;
Â  Â  Â  Â  let selfDmg = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (player.cls.id === 'wise') {
Â  Â  Â  Â  Â  Â  let cost = Math.floor(player.mp * 0.1);
Â  Â  Â  Â  Â  Â  if (cost > 0) { player.mp -= cost; dmgMult += cost * 0.01; if(!isTestingDamage) log(`[å¥¥æœ¯] è€— ${cost} èƒ½, å¢ä¼¤ ${(cost*1).toFixed(0)}%`, '#9b59b6'); }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (player.cls.id === 'berserk') {
Â  Â  Â  Â  Â  Â  let cost = Math.floor(player.hp * 0.2);
Â  Â  Â  Â  Â  Â  selfDmg = cost;
Â  Â  Â  Â  Â  Â  let missingPct = (player.maxHp - player.hp)/player.maxHp * 100;
Â  Â  Â  Â  Â  Â  dmgMult += missingPct * 0.01;
Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`[è¡€æ€’] è€— ${cost} è¡€, å¢ä¼¤ ${missingPct.toFixed(0)}%`, '#c0392b');
Â  Â  Â  Â  }
Â  Â  Â  Â  if (player.cls.id === 'agile') {
Â  Â  Â  Â  Â  Â  extraDmg += player.spd * (1 + Math.floor(player.lvl/10)*0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  let isCrit = Math.random() < player.critRate;
Â  Â  Â  Â  let finalMult = dmgMult;
Â  Â  Â  Â  if (isCrit) finalMult *= player.critDmg;

Â  Â  Â  Â  let dmg = Math.max(1, Math.floor(player.atk * finalMult - enemy.def + extraDmg));
Â  Â  Â  Â  enemy.hp -= dmg;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(isTestingDamage) testTotalDamage += dmg;

Â  Â  Â  Â  let floatColor = isCrit ? '#e74c3c' : '#fff';
Â  Â  Â  Â  let floatSize = isCrit ? '32px' : '22px';
Â  Â  Â  Â  let floatMsg = isCrit ? `æš´å‡»! ${dmg}` : dmg;
Â  Â  Â  Â  floatText(floatMsg, document.getElementById('enemyEl'), floatColor, floatSize);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(!isTestingDamage) log(isCrit ? `âš¡ã€æš´å‡»ã€‘é€ æˆäº† ${dmg} ç‚¹å·¨é¢ä¼¤å®³!` : `ä½ å¯¹ ${enemy.name} é€ æˆ ${dmg} ç‚¹ä¼¤å®³ã€‚`);

Â  Â  Â  Â  if (enemy.hp <= 0 && !isTestingDamage) {
Â  Â  Â  Â  Â  Â  checkResult();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (player.cls.id === 'agile' && enemy.hp > 0) {
Â  Â  Â  Â  Â  Â  let spdCoef = 1.0 + Math.floor(player.lvl/10)*0.2;
Â  Â  Â  Â  Â  Â  let extra = Math.floor(player.spd * spdCoef);
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if(enemy.hp <= 0) return;
Â  Â  Â  Â  Â  Â  Â  Â  enemy.hp -= extra;
Â  Â  Â  Â  Â  Â  Â  Â  if(isTestingDamage) testTotalDamage += extra;
Â  Â  Â  Â  Â  Â  Â  Â  floatText("+" + extra, document.getElementById('enemyEl'), '#f1c40f', '28px');
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`[è¿…æ·] è¿½åŠ  ${extra} çœŸä¼¤`);
Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  if (!isTestingDamage && enemy.hp <= 0) checkResult();
Â  Â  Â  Â  Â  Â  Â  Â  else checkMultiHit();Â 
Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (selfDmg > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  player.hp -= selfDmg;
Â  Â  Â  Â  Â  Â  Â  Â  let drain = Math.floor(dmg * 0.1);
Â  Â  Â  Â  Â  Â  Â  Â  player.hp += drain;
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) floatText(`+${drain}`, document.getElementById('playerEl'), '#2ecc71', '16px');
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`å¸è¡€æ¢å¤ ${drain} çŒ«è¡€`, '#2ecc71');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  if (enemy.hp > 0) checkMultiHit();
Â  Â  Â  Â  Â  Â  else if (!isTestingDamage) checkResult();
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function checkMultiHit() {
Â  Â  Â  Â  let effectiveSpd = player.spd;
Â  Â  Â  Â  if (player.hasLowHpSpd) {
Â  Â  Â  Â  Â  Â  Â let missingPct = (player.maxHp - player.hp) / player.maxHp;
Â  Â  Â  Â  Â  Â  Â effectiveSpd = Math.floor(player.spd * (1 + Math.min(0.6, missingPct)));
Â  Â  Â  Â  }

Â  Â  Â  Â  if (effectiveSpd >= enemy.spd * 2 && Math.random() > 0.4) {
Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(">>> [çŒ«é€Ÿ]ç¢¾å‹ï¼å‘åŠ¨è¿å‡»ï¼ <<<", '#f39c12');
Â  Â  Â  Â  Â  Â  setTimeout(performPlayerAttack, 600);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  isPlayerTurn = false;
Â  Â  Â  Â  Â  Â  setTimeout(battleLoop, 1000);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function performEnemyAttack() {
Â  Â  Â  Â  const eEl = document.getElementById('enemyEl');
Â  Â  Â  Â  eEl.style.transform = 'translateX(-30px)';
Â  Â  Â  Â  setTimeout(() => eEl.style.transform = 'translateX(0)', 200);
Â  Â  Â  Â  showSlash(document.getElementById('playerEl'));

Â  Â  Â  Â  let rawDmg = enemy.atk - player.def;
Â  Â  Â  Â  let minRate = 0.1;Â 
Â  Â  Â  Â  if(stageType === 'elite') minRate = 0.25;
Â  Â  Â  Â  if(stageType === 'boss') minRate = 0.40;
Â  Â  Â  Â  if(stageType === 'evil_dragon') minRate = 0.40;

Â  Â  Â  Â  let minDmg = Math.floor(enemy.atk * minRate);
Â  Â  Â  Â  let dmg = Math.max(minDmg, rawDmg);
Â  Â  Â  Â  dmg = Math.max(1, dmg);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (player.hp - dmg <= 0 && player.cls.id === 'wise' && player.mp > 0 && !player.shieldUsed) {
Â  Â  Â  Â  Â  Â  let needBlock = dmg - (player.hp - 1);
Â  Â  Â  Â  Â  Â  let manaCost = Math.ceil(needBlock / 2);
Â  Â  Â  Â  Â  Â  if (player.mp >= manaCost) {
Â  Â  Â  Â  Â  Â  Â  Â  player.mp -= manaCost;
Â  Â  Â  Â  Â  Â  Â  Â  dmg -= needBlock;
Â  Â  Â  Â  Â  Â  Â  Â  player.shieldUsed = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log("ğŸ›¡ï¸ [å¥¥æœ¯è¶…è½½] æŠ¤ç›¾æŠµæŒ¡äº†è‡´å‘½ä¼¤! (æœ¬æˆ˜é™1æ¬¡)", '#3498db');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  player.hp -= dmg;
Â  Â  Â  Â  floatText(dmg, document.getElementById('playerEl'), '#c0392b');
Â  Â  Â  Â  if(!isTestingDamage) log(`å—åˆ° ${dmg} ä¼¤å®³ã€‚`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateUI();

Â  Â  Â  Â  if (stageType === 'evil_dragon' && player.hp > 0) {
Â  Â  Â  Â  Â  Â  let dragonBreathDmg = Math.floor(player.maxHp * 0.07);
Â  Â  Â  Â  Â  Â  if (dragonBreathDmg > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.hp -= dragonBreathDmg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  floatText(dragonBreathDmg, document.getElementById('playerEl'), '#f1c40f', '24px');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`ğŸ”¥ [é¾™æ¯] é‚ªé¾™å–·åé¾™æ¯ï¼Œé€ æˆ ${dragonBreathDmg} ç‚¹çœŸå®ä¼¤å®³!`, '#c0392b');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isTestingDamage && player.hp <= 0) checkResult();
Â  Â  Â  Â  Â  Â  Â  Â  }, 400);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (player.cls.id === 'resolute' && player.hp > 0) {
Â  Â  Â  Â  Â  Â  let reflect = 0;
Â  Â  Â  Â  Â  Â  if (player.def >= player.atk * 5) {
Â  Â  Â  Â  Â  Â  Â  Â  reflect = player.def * 2 + player.hp * 0.2;
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`[è†æ£˜ç”²å£³] è§¦å‘é«˜é˜¶åä¼¤!`, '#f1c40f');
Â  Â  Â  Â  Â  Â  } else if (player.def >= player.atk * 2) {
Â  Â  Â  Â  Â  Â  Â  Â  reflect = player.def;
Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`[è†æ£˜ç”²å£³] è§¦å‘åä¼¤!`, '#f1c40f');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (reflect > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  let isCrit = Math.random() < player.critRate;
Â  Â  Â  Â  Â  Â  Â  Â  let finalReflect = reflect * (isCrit ? player.critDmg : 1);
Â  Â  Â  Â  Â  Â  Â  Â  let actualDmg = Math.max(1, Math.floor(finalReflect - enemy.def));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enemy.hp -= actualDmg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isTestingDamage) testTotalDamage += actualDmg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let color = isCrit ? '#e74c3c' : '#e67e22';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let msg = isCrit ? `åä¼¤æš´å‡»! ${actualDmg}` : `åä¼¤${actualDmg}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  floatText(msg, document.getElementById('enemyEl'), color);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!isTestingDamage) log(`[è†æ£˜] åå¼¹é€ æˆ ${actualDmg} ä¼¤å®³!`, color);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isTestingDamage) checkResult();
Â  Â  Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (!isTestingDamage) checkResult();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (!isTestingDamage && player.hp > 0) checkResult();
Â  Â  Â  Â  }

Â  Â  Â  Â  if (player.hp > 0 && enemy.hp > 0) {
Â  Â  Â  Â  Â  Â  isPlayerTurn = true;
Â  Â  Â  Â  Â  Â  setTimeout(battleLoop, 800);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function checkResult() {
Â  Â  Â  Â  if(enemy.hp <= 0 && document.getElementById('eName').innerText !== "å·²å‡»è´¥") {
Â  Â  Â  Â  Â  Â  if(bloodInterval) clearInterval(bloodInterval);
Â  Â  Â  Â  Â  Â  if(mechInterval) clearInterval(mechInterval);

Â  Â  Â  Â  Â  Â  let rawName = enemy.name;
Â  Â  Â  Â  Â  Â  document.getElementById('eName').innerText = "å·²å‡»è´¥";
Â  Â  Â  Â  Â  Â  log(`${rawName} å€’ä¸‹äº†!`, '#27ae60');
Â  Â  Â  Â  Â  Â  killCount++;
Â  Â  Â  Â  Â  Â  stageCount++;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let gainExp = player.lvl + 1;
Â  Â  Â  Â  Â  Â  player.exp += gainExp;
Â  Â  Â  Â  Â  Â  while (player.exp >= player.maxExp) {
Â  Â  Â  Â  Â  Â  Â  Â  player.exp -= player.maxExp;
Â  Â  Â  Â  Â  Â  Â  Â  levelUp();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let healHp = Math.floor(player.maxHp * 0.1);
Â  Â  Â  Â  Â  Â  if(player.hasHealKill) {
Â  Â  Â  Â  Â  Â  Â  Â  Â healHp += Math.floor((player.maxHp - player.hp) * 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  Â let healMp = Math.floor((player.maxMp - player.mp) * 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  Â player.mp += healMp;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  player.hp = Math.min(player.maxHp, player.hp + healHp);
Â  Â  Â  Â  Â  Â  log(`èƒœåˆ©æ¢å¤çŠ¶æ€`, '#2ecc71');

Â  Â  Â  Â  Â  Â  gameLevel++;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (stageType === 'boss') lastBossType = 'boss';
Â  Â  Â  Â  Â  Â  else if (stageType === 'evil_dragon') lastBossType = 'evil_dragon';
Â  Â  Â  Â  Â  Â  else lastBossType = null;

Â  Â  Â  Â  Â  Â  if (!isTestingDamage) saveGame();
Â  Â  Â  Â  Â  Â  updateUI();

Â  Â  Â  Â  Â  Â  if (stageType === 'elite' || stageType === 'boss' || stageType === 'evil_dragon') {
Â  Â  Â  Â  Â  Â  Â  Â  if (stageType !== 'evil_dragon') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.eliteKills = (player.eliteKills || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  isPendingRogue = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  stageCount = 0;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  setTimeout(startNextBattle, 1500);

Â  Â  Â  Â  } else if (player.hp <= 0) {
Â  Â  Â  Â  Â  Â  if(bloodInterval) clearInterval(bloodInterval);
Â  Â  Â  Â  Â  Â  if(mechInterval) clearInterval(mechInterval);
Â  Â  Â  Â  Â  Â  player.hp = 0;
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  document.getElementById('goReason').innerText = `åœ¨ç¬¬ ${gameLevel} å±‚è¢« ${enemy.name} å‡»è´¥`;
Â  Â  Â  Â  Â  Â  showLayer('over');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function levelUp() {
Â  Â  Â  Â  player.lvl++;
Â  Â  Â  Â  player.maxExp = player.lvl * 2;Â 
Â  Â  Â  Â  const g = player.cls.growth;
Â  Â  Â  Â  player.atk += g.atk;
Â  Â  Â  Â  player.mp += g.mp; player.maxMp += g.mp;
Â  Â  Â  Â  player.def += g.def;
Â  Â  Â  Â  player.hp += g.hp; player.maxHp += g.hp;
Â  Â  Â  Â  player.spd += g.spd;
Â  Â  Â  Â  floatText("LV UP!", document.getElementById('playerEl'), '#f1c40f', '32px');
Â  Â  Â  Â  log(`å‡çº§! ç­‰çº§ ${player.lvl}`, '#f1c40f');
Â  Â  }

Â  Â  function revivePlayer() {
Â  Â  Â  Â  gameLevel = Math.max(1, gameLevel - 5);
Â  Â  Â  Â  player.hp = player.maxHp;
Â  Â  Â  Â  player.mp = player.maxMp;
Â  Â  Â  Â  stageCount = 0;
Â  Â  Â  Â  lastBossType = null;
Â  Â  Â  Â  log("=== æ—¶å…‰å€’æµï¼Œé‡æ–°å¼€å§‹ ===", '#3498db');
Â  Â  Â  Â  saveGame();
Â  Â  Â  Â  showLayer('battle');
Â  Â  Â  Â  startNextBattle();
Â  Â  }

Â  Â  function showRogueSelection(first = false) {
Â  Â  Â  Â  selectedRogueCard = null;
Â  Â  Â  Â  const container = document.getElementById('rogueContainer');
Â  Â  Â  Â  const btn = document.getElementById('confirmCardBtn');
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  btn.innerText = "è¯·é€‰æ‹©ä¸€é¡¹";
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  let pool = CARDS.filter(c => {
Â  Â  Â  Â  Â  Â  if (c.unique && player.uniqueCards && player.uniqueCards.includes(c.id)) return false;
Â  Â  Â  Â  Â  Â  if (c.minLvl && gameLevel < c.minLvl) return false;
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (lastBossType === 'boss') {
Â  Â  Â  Â  Â  Â  pool = pool.filter(c => c.type !== 'white');
Â  Â  Â  Â  } else if (lastBossType === 'evil_dragon') {
Â  Â  Â  Â  Â  Â  pool = pool.filter(c => c.type !== 'white' && c.type !== 'green');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const shuffled = pool.sort(() => 0.5 - Math.random());
Â  Â  Â  Â  const choices = shuffled.slice(0, 3);

Â  Â  Â  Â  choices.forEach(card => {
Â  Â  Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  Â  Â  el.className = `rogue-card card-${card.type}`;
Â  Â  Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon">${card.icon}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>${card.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${card.desc}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  el.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Array.from(container.children).forEach(c => c.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  selectedRogueCard = card;
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = "ç¡®è®¤é€‰æ‹©";
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  Â  });
Â  Â  Â  Â  showLayer('card');
Â  Â  }

Â  Â  function confirmRogueSelection() {
Â  Â  Â  Â  if (!selectedRogueCard) return;
Â  Â  Â  Â  selectedRogueCard.effect(player);
Â  Â  Â  Â  if (selectedRogueCard.unique) {
Â  Â  Â  Â  Â  Â  if(!player.uniqueCards) player.uniqueCards = [];
Â  Â  Â  Â  Â  Â  player.uniqueCards.push(selectedRogueCard.id);
Â  Â  Â  Â  }
Â  Â  Â  Â  log(`é€‰æ‹©äº† [${selectedRogueCard.title}]`, '#8e44ad');
Â  Â  Â  Â  if(selectedRogueCard.type !== 'green' && !selectedRogueCard.unique) {
Â  Â  Â  Â  Â  Â  Â player.hp = Math.min(player.maxHp, player.hp + player.maxHp * 0.3);
Â  Â  Â  Â  Â  Â  Â player.mp = Math.min(player.maxMp, player.mp + player.maxMp * 0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  showLayer('battle');
Â  Â  Â  Â  startNextBattle();
Â  Â  }

Â  Â  function showAttrPanel() {
Â  Â  Â  Â  if(!player) return;
Â  Â  Â  Â  document.getElementById('attrName').innerText = player.name;
Â  Â  Â  Â  document.getElementById('attrClass').innerText = player.cls.name;
Â  Â  Â  Â  document.getElementById('attrLvl').innerText = player.lvl;
Â  Â  Â  Â  document.getElementById('attrHp').innerText = Math.floor(player.hp) + "/" + player.maxHp;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let displayMp = (Math.floor(player.mp * 10) / 10).toFixed(1);
Â  Â  Â  Â  if(player.cls.id !== 'mech') displayMp = Math.floor(player.mp);

Â  Â  Â  Â  document.getElementById('attrMp').innerText = displayMp + "/" + player.maxMp;
Â  Â  Â  Â  document.getElementById('attrAtk').innerText = player.atk;
Â  Â  Â  Â  document.getElementById('attrDef').innerText = player.def;
Â  Â  Â  Â  document.getElementById('attrSpd').innerText = player.spd;
Â  Â  Â  Â  document.getElementById('attrCrit').innerText = Math.floor(player.critRate * 100) + "%";
Â  Â  Â  Â  document.getElementById('attrCritDmg').innerText = Math.floor(player.critDmg * 100) + "%";
Â  Â  Â  Â  showLayer('attr');
Â  Â  }

Â  Â  function closeAttrPanel() { showLayer('battle'); }

Â  Â  function startDamageTest() {
Â  Â  Â  Â  if(!player || isTestingDamage) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  isTestingDamage = true;
Â  Â  Â  Â  testTotalDamage = 0;
Â  Â  Â  Â  testTimer = 10;
Â  Â  Â  Â Â 
Â  Â  Â  Â  player.hp = player.maxHp;
Â  Â  Â  Â  player.mp = player.maxMp;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let originalEnemy = JSON.parse(JSON.stringify(enemy));
Â  Â  Â  Â Â 
Â  Â  Â  Â  let dummyHp = 9999999;
Â  Â  Â  Â  let dummyAtk = enemy.atk;Â 
Â  Â  Â  Â  let dummyDef = enemy.def;
Â  Â  Â  Â  let dummySpd = enemy.spd;
Â  Â  Â  Â Â 
Â  Â  Â  Â  enemy = {
Â  Â  Â  Â  Â  Â  name: "è®­ç»ƒæœ¨æ¡©",
Â  Â  Â  Â  Â  Â  maxHp: dummyHp,
Â  Â  Â  Â  Â  Â  hp: dummyHp,
Â  Â  Â  Â  Â  Â  atk: dummyAtk,
Â  Â  Â  Â  Â  Â  def: dummyDef,
Â  Â  Â  Â  Â  Â  spd: dummySpd,
Â  Â  Â  Â  Â  Â  visual: SVGS.stake
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('eName').innerText = enemy.name;
Â  Â  Â  Â  document.getElementById('eVisual').innerHTML = enemy.visual;
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â Â 
Â  Â  Â  Â  log("=== å¼€å§‹ä¼¤å®³æµ‹è¯• (10s) ===", '#3498db');
Â  Â  Â  Â  log("æœ¨æ¡©å·²ç”Ÿæˆï¼Œå±æ€§åŒå½“å‰æ€ªç‰©ã€‚", '#7f8c8d');
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(player.cls.id === 'blood') {
Â  Â  Â  Â  Â  Â  Â bloodInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  let dot = Math.floor(player.atk * 0.8 + player.hp * 0.2);
Â  Â  Â  Â  Â  Â  Â  Â  testTotalDamage += dot;
Â  Â  Â  Â  Â  Â  Â  Â  floatText(`-${dot}`, document.getElementById('enemyEl'), '#8e44ad', '20px');
Â  Â  Â  Â  Â  Â  Â }, 1000);
Â  Â  Â  Â  }
Â  Â  Â  Â  if(player.cls.id === 'mech') {
Â  Â  Â  Â  Â  Â  Â mechInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  let cost = Math.floor(player.mp * 0.02);
Â  Â  Â  Â  Â  Â  Â  Â  if (player.mp > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.mp -= cost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(player.mp < 0) player.mp = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let dmgBase = player.atk * 0.25 + player.mp * 0.75;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let isCrit = Math.random() < player.critRate;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let finalDmg = Math.max(1, Math.floor(dmgBase * (isCrit ? player.critDmg : 1)));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  testTotalDamage += finalDmg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  floatText(finalDmg, document.getElementById('enemyEl'), isCrit?'#e74c3c':'#fff');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let charge = Math.max(1, Math.floor(player.maxMp * 0.05));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â player.mp += charge;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â }, 200);
Â  Â  Â  Â  }

Â  Â  Â  Â  testInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  testTimer--;
Â  Â  Â  Â  Â  Â  if (testTimer <= 0) { endDamageTest(originalEnemy); }Â 
Â  Â  Â  Â  Â  Â  else { log(`æµ‹è¯•å‰©ä½™: ${testTimer}s`, '#bdc3c7'); }
Â  Â  Â  Â  }, 1000);
Â  Â  }

Â  Â  function endDamageTest(original) {
Â  Â  Â  Â  clearInterval(testInterval);
Â  Â  Â  Â  if(bloodInterval) clearInterval(bloodInterval);
Â  Â  Â  Â  if(mechInterval) clearInterval(mechInterval);
Â  Â  Â  Â  isTestingDamage = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let dps = (testTotalDamage / 10).toFixed(1);
Â  Â  Â  Â  alert(`=== ä¼¤å®³æµ‹è¯•æŠ¥å‘Š ===\næ€»ä¼¤å®³: ${testTotalDamage}\nç§’ä¼¤(DPS): ${dps}`);
Â  Â  Â  Â  log(`æ€»ä¼¤å®³: ${testTotalDamage}`, '#e67e22');
Â  Â  Â  Â Â 
Â  Â  Â  Â  enemy = original;
Â  Â  Â  Â  document.getElementById('eName').innerText = enemy.name;
Â  Â  Â  Â  document.getElementById('eVisual').innerHTML = enemy.visual;
Â  Â  Â  Â Â 
Â  Â  Â  Â  player.hp = player.maxHp;
Â  Â  Â  Â  player.mp = player.maxMp;Â 
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (enemy.hp <= 0) {Â 
Â  Â  Â  Â  Â  Â  startNextBattle();Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â if(player.cls.id !== 'mech') {
Â  Â  Â  Â  Â  Â  Â  Â  isPlayerTurn = player.spd >= enemy.spd;Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(battleLoop, 1000);Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  startNextBattle();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateUI() {
Â  Â  Â  Â  if(!player) return;
Â  Â  Â  Â  const setBar = (id, cur, max) => { document.getElementById(id).style.width = Math.min(100, Math.max(0, cur/max*100)) + '%'; };
Â  Â  Â  Â  setBar('pHpBar', player.hp, player.maxHp);
Â  Â  Â  Â  setBar('pMpBar', player.mp, player.maxMp);
Â  Â  Â  Â  setBar('eHpBar', enemy ? enemy.hp : 0, enemy ? enemy.maxHp : 1);
Â  Â  Â  Â  setBar('expFill', player.exp, player.maxExp);
Â  Â  Â  Â  document.getElementById('expText').innerText = `${player.exp}/${player.maxExp}`;
Â  Â  Â  Â  document.getElementById('levelText').innerText = gameLevel;
Â  Â  Â  Â  document.getElementById('killText').innerText = killCount;
Â  Â  Â  Â  document.getElementById('pLvVal').innerText = player.lvl;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let displayMp = (Math.floor(player.mp * 10) / 10).toFixed(1);
Â  Â  Â  Â  if(player.cls.id !== 'mech') displayMp = Math.floor(player.mp);
Â  Â  Â  Â  document.getElementById('pMpVal').innerText = `MP: ${displayMp}`;
Â  Â  }
</script>
</body>
</html>